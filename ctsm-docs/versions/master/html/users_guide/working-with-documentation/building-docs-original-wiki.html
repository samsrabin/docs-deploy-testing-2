

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1.10.4. ⚠️ Original docs documentation from the GitHub Wiki &mdash; ctsm CTSM master documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=a16e412b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=c0caff61"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. CLM Technical Note" href="../../tech_note/index.html" />
    <link rel="prev" title="1.10.3. Caveats for working with Markdown" href="caveats-for-working-with-markdown.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ctsm
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">1. CTSM1 User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html">1.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../setting-up-and-running-a-case/index.html">1.2. Setting Up and Running a Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-clm-tools/index.html">1.3. Using CLM tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adding-new-resolutions/index.html">1.4. Adding New Resolutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-special-cases/index.html">1.5. Running Special Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-single-points/index.html">1.6. Running Single Point and Regional Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trouble-shooting/index.html">1.7. Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/index.html">1.8. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-mesh-maker/index.html">1.9. Using mesh_maker</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">1.10. Working with CTSM Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="docs-intro-and-recommended.html">1.10.1. Introduction to working with the CTSM documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="building-docs-multiple-versions.html">1.10.2. Building multiple versions of the documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="caveats-for-working-with-markdown.html">1.10.3. Caveats for working with Markdown</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">1.10.4. ⚠️ Original docs documentation from the GitHub Wiki</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#table-of-contents">1.10.4.1. Table of contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intro-to-the-ctsm-documentation">1.10.4.2. Intro to the CTSM documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-do-i-as-a-contributor-need-to-do-to-update-the-tech-note-for-my-new-feature">1.10.4.3. What do I, as a contributor, need to do to update the tech note for my new feature?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quick-start-to-building-the-documentation">1.10.4.4. Quick start to building the documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview-of-the-recommended-build-method-and-alternative-methods">1.10.4.5. Overview of the recommended build method and alternative methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#one-time-setup-needed-for-a-given-machine">1.10.4.6. One-time setup needed for a given machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#management-of-image-files">1.10.4.7. Management of image files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#procedure-for-building-the-html-documentation">1.10.4.8. Procedure for building the html documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-a-pdf-of-the-tech-note">1.10.4.9. Building a pdf of the tech note</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resources-for-learning-markup-with-restructuredtext-and-using-sphinx">1.10.4.10. Resources for learning markup with reStructuredText and using Sphinx.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#appendix-other-build-methods">1.10.4.11. Appendix: Other build methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#appendix-editing-tips">1.10.4.12. Appendix: Editing tips</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tech_note/index.html">2. CLM Technical Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lilac/index.html">3. CTSM-LILAC User’s Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ctsm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">1. </span>CTSM1 User’s Guide</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">1.10. </span>Working with CTSM Documentation</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1.10.4. </span>⚠️ Original docs documentation from the GitHub Wiki</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/users_guide/working-with-documentation/building-docs-original-wiki.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="original-docs-documentation-from-the-github-wiki">
<span id="building-docs-original-wiki"></span><h1><span class="section-number">1.10.4. </span>⚠️ Original docs documentation from the GitHub Wiki<a class="headerlink" href="#original-docs-documentation-from-the-github-wiki" title="Link to this heading"></a></h1>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>⚠️⚠️⚠️WARNING⚠️⚠️⚠️
This page contains documentation that (a) is more complicated than you probably require and (b) has not been fully checked for accuracy with the latest documentation setup. Unless you have a very good reason, you should probably go to <a class="reference internal" href="docs-intro-and-recommended.html#docs-intro-and-recommended"><span class="std std-ref">Introduction to working with the CTSM documentation</span></a>.</p>
</div>
<section id="table-of-contents">
<h2><span class="section-number">1.10.4.1. </span>Table of contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#intro-to-the-ctsm-documentation"><span class="std std-ref">Intro to the CTSM documentation</span></a></p></li>
<li><p><a class="reference internal" href="#what-do-i-as-a-contributor-need-to-do-to-update-the-tech-note-for-my-new-feature"><span class="std std-ref">What do I, as a contributor, need to do to update the tech note for my new feature?</span></a></p></li>
<li><p><a class="reference internal" href="#quick-start-to-building-the-documentation"><span class="std std-ref">Quick start to building the documentation</span></a></p></li>
<li><p><a class="reference internal" href="#overview-of-the-recommended-build-method-and-alternative-methods"><span class="std std-ref">Overview of the recommended build method and alternative methods</span></a></p></li>
<li><p><a class="reference internal" href="#one-time-setup-needed-for-a-given-machine"><span class="std std-ref">One-time setup needed for a given machine</span></a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites"><span class="std std-ref">Prerequisites</span></a></p></li>
<li><p><a class="reference internal" href="#install-docker-and-download-the-required-container"><span class="std std-ref">Install Docker and download the required container</span></a></p></li>
<li><p><a class="reference internal" href="#install-git-lfs"><span class="std std-ref">Install git-lfs</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#management-of-image-files"><span class="std std-ref">Management of image files</span></a></p>
<ul>
<li><p><a class="reference internal" href="#obtaining-the-image-files"><span class="std std-ref">Obtaining the image files</span></a></p></li>
<li><p><a class="reference internal" href="#seeing-what-files-are-tracked-by-git-lfs"><span class="std std-ref">Seeing what files are tracked by git-lfs</span></a></p></li>
<li><p><a class="reference internal" href="#adding-a-new-image-file-type"><span class="std std-ref">Adding a new image file type</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#procedure-for-building-the-html-documentation"><span class="std std-ref">Procedure for building the html documentation</span></a></p>
<ul>
<li><p><a class="reference internal" href="#recommended-directory-structure-for-these-directions"><span class="std std-ref">Recommended directory structure for these directions</span></a></p></li>
<li><p><a class="reference internal" href="#initial-steps-for-building-the-documentation"><span class="std std-ref">Initial steps for building the documentation</span></a></p></li>
<li><p><a class="reference internal" href="#building-a-test-version-of-the-documentation-for-your-own-review"><span class="std std-ref">Building a test version of the documentation for your own review</span></a></p></li>
<li><p><a class="reference internal" href="#previewing-the-built-documentation"><span class="std std-ref">Previewing the built documentation</span></a></p></li>
<li><p><a class="reference internal" href="#updating-the-official-html-documentation"><span class="std std-ref">Updating the official html documentation</span></a></p></li>
<li><p><a class="reference internal" href="#dealing-with-errors"><span class="std std-ref">Dealing with errors</span></a></p>
<ul>
<li><p><a class="reference internal" href="#inputoutput-error"><span class="std std-ref">Input/output error</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-a-new-version"><span class="std std-ref">Adding a new version</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-a-pdf-of-the-tech-note"><span class="std std-ref">Building a pdf of the tech note</span></a></p></li>
<li><p><a class="reference internal" href="#resources-for-learning-markup-with-restructuredtext-and-using-sphinx"><span class="std std-ref">Resources for learning markup with reStructuredText and using Sphinx.</span></a></p></li>
<li><p><a class="reference internal" href="#appendix-other-build-methods"><span class="std std-ref">Appendix: Other build methods</span></a></p>
<ul>
<li><p><a class="reference internal" href="#running-build-docs-from-all-of-these-methods"><span class="std std-ref">Running build_docs from all of these methods</span></a></p></li>
<li><p><a class="reference internal" href="#relying-more-heavily-on-the-docker-container"><span class="std std-ref">Relying more heavily on the Docker container</span></a></p>
<ul>
<li><p><a class="reference internal" href="#launching-the-docker-image"><span class="std std-ref">Launching the Docker image</span></a></p></li>
<li><p><a class="reference internal" href="#building-the-documentation"><span class="std std-ref">Building the documentation</span></a></p></li>
<li><p><a class="reference internal" href="#viewing-the-built-documentation"><span class="std std-ref">Viewing the built documentation</span></a></p></li>
<li><p><a class="reference internal" href="#committing-to-git-repositories"><span class="std std-ref">Committing to git repositories</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installing-required-software-on-your-desktoplaptop-instructions-for-mac"><span class="std std-ref">Installing required software on your desktop/laptop (instructions for Mac)</span></a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites-assumptions"><span class="std std-ref">Prerequisites / assumptions</span></a></p></li>
<li><p><a class="reference internal" href="#installing-sphinx-and-the-necessary-sphinx-theme"><span class="std std-ref">Installing Sphinx and the necessary Sphinx theme</span></a></p></li>
<li><p><a class="reference internal" href="#installing-latexmk"><span class="std std-ref">Installing latexmk</span></a></p></li>
<li><p><a class="reference internal" href="#optionally-installing-components-needed-to-build-the-pdf"><span class="std std-ref">Optionally installing components needed to build the PDF</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-the-documentation-on-cheyenne"><span class="std std-ref">Building the documentation on cheyenne</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#appendix-editing-tips"><span class="std std-ref">Appendix: Editing tips</span></a></p></li>
</ul>
</section>
<section id="intro-to-the-ctsm-documentation">
<span id="id2"></span><h2><span class="section-number">1.10.4.2. </span>Intro to the CTSM documentation<a class="headerlink" href="#intro-to-the-ctsm-documentation" title="Link to this heading"></a></h2>
<p>The CTSM documentation is written using <a class="reference external" href="http://www.sphinx-doc.org/en/stable/rest.html">reStructuredText markup language</a>. ReStructuredText is a markup language, like HTML, markdown or latex. (See below for more resources on learning reStructuredText.)</p>
<p><a class="reference external" href="http://www.sphinx-doc.org/en/stable/index.html">Sphinx</a> is a python tool for publishing reStructuredText documents in other formats such as HTML and PDF.</p>
<p>The CTSM documentation source is stored in the <code class="docutils literal notranslate"><span class="pre">doc/source</span></code> directory of the main CTSM repository. The built documentation is stored in the gh-pages branch of the <a class="reference external" href="https://github.com/escomp/ctsm-docs">ESCOMP/ctsm-docs repository</a>. The Sphinx-generated HTML pages are accessible from URL <a class="reference external" href="https://escomp.github.io/ctsm-docs/">https://escomp.github.io/ctsm-docs/</a></p>
</section>
<section id="what-do-i-as-a-contributor-need-to-do-to-update-the-tech-note-for-my-new-feature">
<span id="id3"></span><h2><span class="section-number">1.10.4.3. </span>What do I, as a contributor, need to do to update the tech note for my new feature?<a class="headerlink" href="#what-do-i-as-a-contributor-need-to-do-to-update-the-tech-note-for-my-new-feature" title="Link to this heading"></a></h2>
<p>As a contributor to CTSM, you don’t necessarily need to know all of the information laid out below. If you need to update the tech note for some changes you have made, you should add or edit the necessary rst files in <code class="docutils literal notranslate"><span class="pre">doc/source/tech_note</span></code> on your CTSM branch. Then simply commit your changes to these rst files just as you would do for changes to Fortran source files, and include these rst changes in your Pull Request. Ideally these documentation changes will be on the same branch and the same Pull Request as the related source file changes, but they can also be made later, on a separate branch, and submitted to us via a separate Pull Request. In either case, the CTSM maintainers will review the documentation changes in the Pull Request and merge these changes to CTSM’s master branch when ready.</p>
<p>You do <em>not</em> need to open a Pull Request for the built documentation: one of the CTSM maintainers will rebuild the documentation later. However, if you have made more than minor edits to the documentation, we prefer if you have tested the documentation build to make sure there are no errors in the edited rst files and that the html documentation appears how you intended. But you do <em>not</em> need to send us or point us to your rebuilt documentation: One of the CTSM maintainers will build the documentation themselves to review the build.</p>
<p>If you need to build the documentation, and/or if you need to change or add any images, you will need to keep reading for instructions on installing and using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span></code>.</p>
</section>
<section id="quick-start-to-building-the-documentation">
<span id="id4"></span><h2><span class="section-number">1.10.4.4. </span>Quick start to building the documentation<a class="headerlink" href="#quick-start-to-building-the-documentation" title="Link to this heading"></a></h2>
<p>This documentation gives detailed explanations of a number of workflows that can be used in building the documentation. This section briefly summarizes a single, recommended workflow, so that you can get started quickly.</p>
<p>First, as one-time setup, you will need to install:</p>
<ul class="simple">
<li><p>A recent version of git</p></li>
<li><p>A recent version of python (python3.5 or later), available as <code class="docutils literal notranslate"><span class="pre">python3</span></code></p></li>
<li><p><a class="reference external" href="https://www.docker.com/products/docker-desktop">Docker</a></p></li>
<li><p><a class="reference external" href="https://git-lfs.github.com/">Git LFS</a>, including running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">install</span></code> (required if you will be adding or editing any image files, otherwise you can skip Git LFS for now) You should then launch Docker’s desktop application, and run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">escomp/base</span></code>.</p></li>
</ul>
<p>Then (if you haven’t already done so), clone the CTSM repository (this example assumes that it appears in a path like this: <code class="docutils literal notranslate"><span class="pre">~/ctsm-repos/ctsm</span></code>). Check out the branch from which you want to build the documentation, then run <code class="docutils literal notranslate"><span class="pre">./bin/git-fleximod</span> <span class="pre">update</span> <span class="pre">--optional</span></code>.</p>
<p>Then build the documentation like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>~/ctsm-repos/ctsm-docs
<span class="nb">cd</span><span class="w"> </span>~/ctsm-repos/ctsm/doc
./build_docs<span class="w"> </span>-b<span class="w"> </span>~/ctsm-repos/ctsm-docs<span class="w"> </span>-d
</pre></div>
</div>
<p>and view it by opening the file <code class="docutils literal notranslate"><span class="pre">~/ctsm-repos/ctsm-docs/html/index.html</span></code>.</p>
</section>
<section id="overview-of-the-recommended-build-method-and-alternative-methods">
<span id="id5"></span><h2><span class="section-number">1.10.4.5. </span>Overview of the recommended build method and alternative methods<a class="headerlink" href="#overview-of-the-recommended-build-method-and-alternative-methods" title="Link to this heading"></a></h2>
<p>The directions here assume use of a documentation build method where you are working on your local desktop / laptop, and have some basic software installed there, but use a Docker container-based method for doing the actual documentation build. Other methods are documented in an <a class="reference internal" href="#appendix-other-build-methods"><span class="std std-ref">Appendix below</span></a>. We prefer the Docker-based method because it avoids the complexity of installing multiple packages on your local machine, and ensures that all people building the documentation are using the same versions of Sphinx and other utilities. The main method described here leverages this Docker container while still allowing you to remain in the comfort of your own local environment. However, some people may prefer <a class="reference internal" href="#relying-more-heavily-on-the-docker-container"><span class="std std-ref">the more Docker-centric method described in the Appendix</span></a>, because it has even fewer initial installation requirements. <strong>That solution may also work more smoothly on a Windows system, though we have run the primary method successfully on Windows after ensuring that we have an executable named python3 installed.</strong></p>
</section>
<section id="one-time-setup-needed-for-a-given-machine">
<span id="id6"></span><h2><span class="section-number">1.10.4.6. </span>One-time setup needed for a given machine<a class="headerlink" href="#one-time-setup-needed-for-a-given-machine" title="Link to this heading"></a></h2>
<section id="prerequisites">
<span id="id7"></span><h3><span class="section-number">1.10.4.6.1. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<p>These instructions assume that you have the following available on your machine:</p>
<ul class="simple">
<li><p>A recent version of git, ideally configured according to the recommendations in <a class="reference external" href="https://github.com/ESCOMP/CTSM/wiki/Recommended-git-setup#one-time-git-configuration">https://github.com/ESCOMP/CTSM/wiki/Recommended-git-setup#one-time-git-configuration</a>.</p></li>
<li><p>A recent version of python (python3.5 or later)</p>
<ul>
<li><p>Note that this must be available as <code class="docutils literal notranslate"><span class="pre">python3</span></code> (not just <code class="docutils literal notranslate"><span class="pre">python</span></code>). If your python installation did not create a <code class="docutils literal notranslate"><span class="pre">python3</span></code> command, you will need to create an alias or symbolic link so that python can be invoked via <code class="docutils literal notranslate"><span class="pre">python3</span></code>. On Windows, one developer reports success after copying <code class="docutils literal notranslate"><span class="pre">C:\Users\USERNAME\AppData\Local\Programs\Python\Python39\python.exe</span></code> to <code class="docutils literal notranslate"><span class="pre">python3.exe</span></code> (in the same location).</p></li>
</ul>
</li>
</ul>
</section>
<section id="install-docker-and-download-the-required-container">
<span id="id8"></span><h3><span class="section-number">1.10.4.6.2. </span>Install Docker and download the required container<a class="headerlink" href="#install-docker-and-download-the-required-container" title="Link to this heading"></a></h3>
<p>Download Docker to your personal desktop or laptop from <a class="reference external" href="https://www.docker.com/products/docker-desktop">Docker</a> and follow the instructions. Then launch the Docker application.</p>
<p>You can then obtain the necessary Docker container by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>escomp/base
</pre></div>
</div>
<p>Note: For some versions of Docker on a Mac, Docker’s CPU usage can remain at 100% even after the documentation build process exits. This seems to be connected with the issue reported in <a class="reference external" href="https://github.com/docker/for-mac/issues/5164">https://github.com/docker/for-mac/issues/5164</a>. The issue probably arises because the <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> script mounts your entire home directory in the docker container. You can work around this issue by quitting Docker when you are done building the docs, or by unchecking the option, “Use gRPC FUSE for file sharing” in Docker’s preferences. However, note that unchecking that option might have some negative consequences, so you may want to re-enable it when you are done building the documentation if you use Docker for other purposes as well.</p>
</section>
<section id="install-git-lfs">
<span id="id10"></span><h3><span class="section-number">1.10.4.6.3. </span>Install git-lfs<a class="headerlink" href="#install-git-lfs" title="Link to this heading"></a></h3>
<p>Git-LFS (Large File Support) is needed if you will be adding or editing any image files. <strong>If there is even a chance that you will be doing so, it is best to go ahead and install this now, while you are thinking about it. This will prevent you from accidentally committing an image file directly to the repository, which is something we try very hard to avoid.</strong> This is also needed for building the documentation if <em>not</em> using the Docker-based method.</p>
<p>Follow the instructions on the <a class="reference external" href="https://git-lfs.github.com/">Git LFS page</a> for installing git-lfs on your platform. (On a Mac using homebrew, this can be done with <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">git-lfs</span></code>.)</p>
<p><strong>Although the actual installation only needs to be done once per machine, each user who wants to use it must then run the following command to set up git-lfs for your user account on this machine:</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>lfs<span class="w"> </span>install
</pre></div>
</div>
</section>
</section>
<section id="management-of-image-files">
<span id="id11"></span><h2><span class="section-number">1.10.4.7. </span>Management of image files<a class="headerlink" href="#management-of-image-files" title="Link to this heading"></a></h2>
<p><strong>If you are adding or changing any image files, be sure you have installed git-lfs according to the :ref:`above instructions &lt;Install-git-lfs&gt;`, including running</strong> <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">install</span></code>. If you are not sure whether you have already run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">install</span></code>, it is safe to rerun that command to be sure.</p>
<p>Image files are tracked using Git LFS (Large File Support). The images are stored somewhere on GitHub, but aren’t actually part of the main repository. Instead, the repository contains small text files that direct git-lfs to the appropriate storage location on GitHub.</p>
<p>For the most part, you can remain blissfully unaware of the details of how this works. For example, if you want to add a new image file to the repository, the process is just like adding any other file to the repository, as long as you have installed git-lfs. In addition, building the documentation does not require any additional steps - again, as long as you have installed git-lfs. But here are some notes that may help you:</p>
<section id="obtaining-the-image-files">
<span id="id12"></span><h3><span class="section-number">1.10.4.7.1. </span>Obtaining the image files<a class="headerlink" href="#obtaining-the-image-files" title="Link to this heading"></a></h3>
<p>We have configured git-lfs for CTSM so that it does <em>not</em> pull down any images by default, since these images are only rarely needed. If you have cloned CTSM or updated an existing clone and want to get the latest version of the image files, you can run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>lfs<span class="w"> </span>pull<span class="w"> </span>--exclude<span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"> </span>--include<span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Note that this is done automatically when building the documentation via the <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> command, as described below.</p>
</section>
<section id="seeing-what-files-are-tracked-by-git-lfs">
<span id="id13"></span><h3><span class="section-number">1.10.4.7.2. </span>Seeing what files are tracked by git-lfs<a class="headerlink" href="#seeing-what-files-are-tracked-by-git-lfs" title="Link to this heading"></a></h3>
<p>To see what file types (extensions) are tracked by git-lfs, run the following from within your CTSM clone:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>lfs<span class="w"> </span>track
</pre></div>
</div>
<p>To see every file currently being managed by git-lfs, run the following from within your CTSM clone:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>lfs<span class="w"> </span>ls-files<span class="w"> </span>--exclude<span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"> </span>--include<span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</section>
<section id="adding-a-new-image-file-type">
<span id="id14"></span><h3><span class="section-number">1.10.4.7.3. </span>Adding a new image file type<a class="headerlink" href="#adding-a-new-image-file-type" title="Link to this heading"></a></h3>
<p>If you want to add a new image file type, with an extension not currently being managed by git-lfs, use this process <strong>before</strong> adding the file to the git repository. Note that this assumes that you are in the top-level directory of your CTSM clone:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>lfs<span class="w"> </span>track<span class="w"> </span><span class="s2">&quot;*.extension&quot;</span>
git<span class="w"> </span>add<span class="w"> </span>.gitattributes
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Use git-lfs for *.extension files&quot;</span>
</pre></div>
</div>
<p>Then you can check that it worked by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">track</span></code>. Finally, you can add your new file with standard <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> commands.</p>
</section>
</section>
<section id="procedure-for-building-the-html-documentation">
<span id="id15"></span><h2><span class="section-number">1.10.4.8. </span>Procedure for building the html documentation<a class="headerlink" href="#procedure-for-building-the-html-documentation" title="Link to this heading"></a></h2>
<section id="recommended-directory-structure-for-these-directions">
<span id="id16"></span><h3><span class="section-number">1.10.4.8.1. </span>Recommended directory structure for these directions<a class="headerlink" href="#recommended-directory-structure-for-these-directions" title="Link to this heading"></a></h3>
<p>In order to give concrete examples, we assume a particular directory structure for these directions: We assume you have a directory in your home directory named <code class="docutils literal notranslate"><span class="pre">ctsm-repos</span></code>, and that you clone the main CTSM repository and the ctsm-docs repository inside that directory. So you will have something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">ctsm</span><span class="o">-</span><span class="n">repos</span><span class="o">/</span><span class="n">ctsm</span>
<span class="o">~/</span><span class="n">ctsm</span><span class="o">-</span><span class="n">repos</span><span class="o">/</span><span class="n">ctsm</span><span class="o">-</span><span class="n">docs</span>
</pre></div>
</div>
<p>It’s fine for your <code class="docutils literal notranslate"><span class="pre">ctsm</span></code> directory to be named something more specific, for example, including the branch name as is recommended <a class="reference external" href="https://github.com/ESCOMP/CTSM/wiki/Quick-start-to-CTSM-development-with-git">on the CTSM GitHub wiki</a>. It is also fine to use a different directory organization, but <strong>if you are using the preferred, Docker container-based method, then both your main CTSM clone and the ctsm-docs clone must reside somewhere under your home directory.</strong></p>
</section>
<section id="initial-steps-for-building-the-documentation">
<span id="id17"></span><h3><span class="section-number">1.10.4.8.2. </span>Initial steps for building the documentation<a class="headerlink" href="#initial-steps-for-building-the-documentation" title="Link to this heading"></a></h3>
<p>The following procedure assumes you have a clone of CTSM that is checked out at the branch from which you want to build documentation.</p>
<p>Before building the documentation, you need to do the following:</p>
<p>First, run <code class="docutils literal notranslate"><span class="pre">./bin/git-fleximod</span> <span class="pre">update</span> <span class="pre">--optional</span></code> to update your submodules; this is needed both to get <code class="docutils literal notranslate"><span class="pre">PTCLM</span></code> (which has some files referenced by the documentation build) and to get the <code class="docutils literal notranslate"><span class="pre">doc-builder</span></code> submodule that is used to do the build. <strong>Note the use of the</strong> <code class="docutils literal notranslate"><span class="pre">--optional</span></code> <strong>flag here; this is needed because</strong> <code class="docutils literal notranslate"><span class="pre">doc-builder</span></code> <strong>is an optional submodule.</strong></p>
<p>Next, if it’s not already running, launch the Docker desktop application.</p>
<p>Finally, if you haven’t updated the <code class="docutils literal notranslate"><span class="pre">escomp/base</span></code> image in a while, you may want to update to the latest version with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>escomp/base
</pre></div>
</div>
</section>
<section id="building-a-test-version-of-the-documentation-for-your-own-review">
<span id="id18"></span><h3><span class="section-number">1.10.4.8.3. </span>Building a test version of the documentation for your own review<a class="headerlink" href="#building-a-test-version-of-the-documentation-for-your-own-review" title="Link to this heading"></a></h3>
<p>If you are just building a test version of the documentation for your own review, then you don’t need to do anything with the <code class="docutils literal notranslate"><span class="pre">ctsm-docs</span></code> GitHub repository. Instead, you can create a directory according to the <a class="reference internal" href="#recommended-directory-structure-for-these-directions"><span class="std std-ref">above recommendations for directory structure</span></a>.</p>
<p>(However, you may want to follow a procedure similar to the one <a class="reference internal" href="#updating-the-official-html-documentation"><span class="std std-ref">documented below for updating the official html documentation</span></a>: That allows you to do an incremental build rather than building the whole documentation from scratch, which can take about 1/2 hour. You can just avoid committing and pushing when following that procedure, if all you want is to preview the documentation for your own review.)</p>
<p>If you are using the <a class="reference internal" href="#recommended-directory-structure-for-these-directions"><span class="std std-ref">above recommendations for directory structure</span></a>, do the following from the <code class="docutils literal notranslate"><span class="pre">doc</span></code> directory of your ctsm clone:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>~/ctsm-repos/ctsm-docs
./build_docs<span class="w"> </span>-b<span class="w"> </span>~/ctsm-repos/ctsm-docs<span class="w"> </span>-d
</pre></div>
</div>
<p>(where the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag instructs <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> to use the <code class="docutils literal notranslate"><span class="pre">escomp/base</span></code> Docker container to do the build).</p>
</section>
<section id="previewing-the-built-documentation">
<span id="id19"></span><h3><span class="section-number">1.10.4.8.4. </span>Previewing the built documentation<a class="headerlink" href="#previewing-the-built-documentation" title="Link to this heading"></a></h3>
<p>You can then view your changes in a local browser window using a command like one of these:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>open<span class="w"> </span>~/ctsm-repos/ctsm-docs/html/index.html
firefox<span class="w"> </span>~/ctsm-repos/ctsm-docs/html/index.html
konqueror<span class="w"> </span>~/ctsm-repos/ctsm-docs/html/index.html
</pre></div>
</div>
<p><strong>Note that the version dropdown menu will not work in these local previews.</strong></p>
</section>
<section id="updating-the-official-html-documentation">
<span id="id20"></span><h3><span class="section-number">1.10.4.8.5. </span>Updating the official html documentation<a class="headerlink" href="#updating-the-official-html-documentation" title="Link to this heading"></a></h3>
<p>If you want to update the official html documentation, follow the below procedure. (You can also use this procedure if you only intend to build a test version for your own review. This can be helpful because this procedure allows for an incremental build rather than building the entire documentation from scratch.) First clone the ctsm-docs repository to somewhere outside of your main CTSM repository. Here we’ll assume that you are using the <a class="reference internal" href="#recommended-directory-structure-for-these-directions"><span class="std std-ref">above recommendations for directory structure</span></a>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ctsm-repos
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/ESCOMP/ctsm-docs.git
</pre></div>
</div>
<p>Or, if you already have a copy of ctsm-docs, make sure it is up-to-date as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ctsm-repos/ctsm-docs
git<span class="w"> </span>checkout<span class="w"> </span>--<span class="w"> </span>.
git<span class="w"> </span>pull
</pre></div>
</div>
<p>Next, <code class="docutils literal notranslate"><span class="pre">cd</span></code> to the <code class="docutils literal notranslate"><span class="pre">doc</span></code> directory of your main CTSM clone:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ctsm-repos/ctsm/doc
</pre></div>
</div>
<p>Then, to perform an incremental build (only updating files that need to be updated), run the following. <strong>Note that the following assumes you are building the documentation for the master branch; if you are building the documentation for one of the release branches, replace</strong> <code class="docutils literal notranslate"><span class="pre">master</span></code> <strong>with the appropriate version.</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./build_docs<span class="w"> </span>-b<span class="w"> </span>~/ctsm-repos/ctsm-docs/versions/master<span class="w"> </span>-d
</pre></div>
</div>
<p>(where the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag instructs <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> to use the <code class="docutils literal notranslate"><span class="pre">escomp/base</span></code> Docker container to do the build).</p>
<p>However, if there have been significant changes to the documentation since the last documentation build, and you are intending to push the new build back to GitHub, it’s probably best to first clean out the old build in order to remove any no-longer-relevant files. The downside of doing this is that the full documentation rebuild will take about 1/2 hour:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./build_docs<span class="w"> </span>-b<span class="w"> </span>~/ctsm-repos/ctsm-docs/versions/master<span class="w"> </span>-d<span class="w"> </span>-c
</pre></div>
</div>
<p>(where the <code class="docutils literal notranslate"><span class="pre">-c</span></code> flag instructs <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> to first run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> in the specified directory).</p>
<p>You can preview the documentation as noted <a class="reference internal" href="#previewing-the-built-documentation"><span class="std std-ref">above</span></a>, but now the <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file will be in <code class="docutils literal notranslate"><span class="pre">~/ctsm-repos/ctsm-docs/versions/master/html/index.html</span></code>. <strong>Note that the version dropdown menu appear when you preview the documentation locally, but if you haven’t built all the versions, some version links will lead to nonexistent files.</strong></p>
<p>Then commit and push the rebuilt documentation as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ctsm-repos/ctsm-docs
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;YOUR MESSAGE&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>gh-pages
</pre></div>
</div>
<p><strong>Note if you’re using a Windows machine: You may see a lot of warnings like</strong> <code class="docutils literal notranslate"><span class="pre">warning:</span> <span class="pre">LF</span> <span class="pre">will</span> <span class="pre">be</span> <span class="pre">replaced</span> <span class="pre">by</span> <span class="pre">CRLF</span> <span class="pre">in</span> <span class="pre">path/to/some/file</span></code>. <strong>These seem safe to ignore in this case.</strong></p>
<p>Within a few minutes, the official documentation at <a class="reference external" href="https://escomp.github.io/ctsm-docs/">https://escomp.github.io/ctsm-docs/</a> will be updated automatically. Note that you can also fork the ctsm-docs repository and push the gh-pages branch to your fork to allow others to preview the documentation before you overwrite the official documentation.</p>
</section>
<section id="dealing-with-errors">
<span id="id22"></span><h3><span class="section-number">1.10.4.8.6. </span>Dealing with errors<a class="headerlink" href="#dealing-with-errors" title="Link to this heading"></a></h3>
<section id="input-output-error">
<span id="inputoutput-error"></span><h4><span class="section-number">1.10.4.8.6.1. </span>Input/output error<a class="headerlink" href="#input-output-error" title="Link to this heading"></a></h4>
<p>Some people have reported an error like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Exception<span class="w"> </span>occurred:
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/usr/lib64/python3.6/shutil.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">205</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>copystat
<span class="w">    </span><span class="nv">follow_symlinks</span><span class="o">=</span>follow<span class="o">)</span>
OSError:<span class="w"> </span><span class="o">[</span>Errno<span class="w"> </span><span class="m">5</span><span class="o">]</span><span class="w"> </span>Input/output<span class="w"> </span>error
The<span class="w"> </span>full<span class="w"> </span>traceback<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>saved<span class="w"> </span><span class="k">in</span><span class="w"> </span>/tmp/sphinx-err-hhpnw_mt.log,<span class="w"> </span><span class="k">if</span><span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>report<span class="w"> </span>the<span class="w"> </span>issue<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>developers.
</pre></div>
</div>
<p>Rerunning the build command will restart it where it left off, and our experience is that that will let you complete the build - though you may need to rerun the build command a few times before it finally finishes successfully.</p>
</section>
</section>
<section id="adding-a-new-version">
<span id="id23"></span><h3><span class="section-number">1.10.4.8.7. </span>Adding a new version<a class="headerlink" href="#adding-a-new-version" title="Link to this heading"></a></h3>
<p>If you want to add a new version of the built documentation, so that it appears in the dropdown menu, follow this process:</p>
<ul class="simple">
<li><p>In the ctsm-docs repository, create a new directory under <code class="docutils literal notranslate"><span class="pre">versions</span></code> with the name of the new version. Our convention is that this name should be the same as the name of the branch in the main CTSM repository that contains this version of the documentation source.</p></li>
<li><p>In the ctsm-docs repository, add a line in the file <code class="docutils literal notranslate"><span class="pre">versions/versions.json</span></code>. Note that each line is a colon-delimited mapping; the name before the colon is the directory name (i.e., the name of the directory you just created, which is the same as the branch name in the CTSM repository), and the name after the colon is the version name that you want to appear in the dropdown menu. Make sure there is a comma at the end of every line except for the last in this file.</p></li>
<li><p>In the main CTSM repository, check out the branch from which you want to build the documentation.</p></li>
<li><p>In the main CTSM repository, edit the file <code class="docutils literal notranslate"><span class="pre">doc/source/conf.py</span></code>: edit the <code class="docutils literal notranslate"><span class="pre">version</span></code> and <code class="docutils literal notranslate"><span class="pre">release</span></code> variables (these should probably be the same as the version name that will appear in the dropdown menu) and anything else that needs to be changed for this release (<code class="docutils literal notranslate"><span class="pre">copyright</span></code>, etc.)</p></li>
<li><p>Build the documentation as described above, being sure to specify your new directory for <code class="docutils literal notranslate"><span class="pre">BUILDDIR</span></code>.</p></li>
</ul>
</section>
</section>
<section id="building-a-pdf-of-the-tech-note">
<span id="id24"></span><h2><span class="section-number">1.10.4.9. </span>Building a pdf of the tech note<a class="headerlink" href="#building-a-pdf-of-the-tech-note" title="Link to this heading"></a></h2>
<p>To build a pdf of the tech note (note that we currently do not support building a pdf of the user’s guide), do the following from the <code class="docutils literal notranslate"><span class="pre">doc</span></code> directory of your CTSM clone:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>~/ctsm-repos/ctsm-docs-pdf
./build_docs<span class="w"> </span>-b<span class="w"> </span>~/ctsm-repos/ctsm-docs-pdf<span class="w"> </span>-d<span class="w"> </span>-t<span class="w"> </span>latexpdf
</pre></div>
</div>
<p>The pdf will appear at <code class="docutils literal notranslate"><span class="pre">~/ctsm-repos/ctsm-docs-pdf/latex/clmdoc.pdf</span></code>.</p>
</section>
<section id="resources-for-learning-markup-with-restructuredtext-and-using-sphinx">
<span id="id25"></span><h2><span class="section-number">1.10.4.10. </span>Resources for learning markup with reStructuredText and using Sphinx.<a class="headerlink" href="#resources-for-learning-markup-with-restructuredtext-and-using-sphinx" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.sphinx-doc.org/en/stable/rest.html">reStructuredText Primer</a></p></li>
<li><p><a class="reference external" href="https://wiki.typo3.org/ReST_Syntax">ReST Syntax</a></p></li>
<li><p><a class="reference external" href="http://www.sphinx-doc.org/en/stable/">Sphinx (including how to get Sphinx)</a></p></li>
<li><p><a class="reference external" href="http://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html#tables">reStructured syntax</a></p></li>
</ul>
</section>
<section id="appendix-other-build-methods">
<span id="id26"></span><h2><span class="section-number">1.10.4.11. </span>Appendix: Other build methods<a class="headerlink" href="#appendix-other-build-methods" title="Link to this heading"></a></h2>
<section id="running-build-docs-from-all-of-these-methods">
<span id="id27"></span><h3><span class="section-number">1.10.4.11.1. </span>Running build_docs from all of these methods<a class="headerlink" href="#running-build-docs-from-all-of-these-methods" title="Link to this heading"></a></h3>
<p>With all of these alternative methods, you can still use <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> commands similar to those given elsewhere in these instructions, <strong>but without the</strong> <code class="docutils literal notranslate"><span class="pre">-d</span></code> <strong>argument</strong>.</p>
</section>
<section id="relying-more-heavily-on-the-docker-container">
<span id="id28"></span><h3><span class="section-number">1.10.4.11.2. </span>Relying more heavily on the Docker container<a class="headerlink" href="#relying-more-heavily-on-the-docker-container" title="Link to this heading"></a></h3>
<p>The above instructions still require you to have recent versions of python, git and git-lfs. Alternatively, you can use a method that relies more heavily on the Docker container, avoiding the need for other software to be installed. <strong>This is a very reasonable alternative method, which some people may prefer - especially if you are already comfortable using Docker containers.</strong></p>
<p>To start, <a class="reference internal" href="#install-docker-and-download-the-required-container"><span class="std std-ref">follow the instructions for installing Docker and downloading the required container</span></a>. Then use the instructions below.</p>
<section id="launching-the-docker-image">
<span id="id29"></span><h4><span class="section-number">1.10.4.11.2.1. </span>Launching the Docker image<a class="headerlink" href="#launching-the-docker-image" title="Link to this heading"></a></h4>
<p>Assuming that both your main CTSM repository and ctsm-docs repository are cloned somewhere within your home directory, you can launch the Docker image like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>-t<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>:/home/user/mounted_home<span class="w"> </span>escomp/base
</pre></div>
</div>
<p>This tells docker to <em>run</em> the container (<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>), interactively (<code class="docutils literal notranslate"><span class="pre">-i</span></code>) with a terminal (<code class="docutils literal notranslate"><span class="pre">-t</span></code>), to clean up the container after running (<code class="docutils literal notranslate"><span class="pre">--rm</span></code>), and most importantly, to map your local <code class="docutils literal notranslate"><span class="pre">${HOME}</span></code> directory into the <code class="docutils literal notranslate"><span class="pre">/home/user/mounted_home</span></code> directory inside the container (<code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">${HOME}:/home/user/mounted_home</span></code>).</p>
<p>After running this command, you will see a command prompt, but now you will be in the Docker environment. This means:</p>
<ul class="simple">
<li><p>You will be able to see directories and files contained in your local <code class="docutils literal notranslate"><span class="pre">${HOME}</span></code> directory, but nothing else. <code class="docutils literal notranslate"><span class="pre">${HOME}/mounted_home</span></code> in the Docker environment refers to <code class="docutils literal notranslate"><span class="pre">${HOME}</span></code> in your native system environment. Changed or added files here will be visible in your native system, in the appropriate subdirectory of your <code class="docutils literal notranslate"><span class="pre">${HOME}</span></code> directory. This will become important later in these directions, since you will view the generated documentation from your native environment.</p></li>
<li><p>Any commands you run from this environment will use the commands bundled with the Docker image, <em>not</em> the commands in your native system environment.</p></li>
</ul>
<p>When you are done using this Docker image, simply type <code class="docutils literal notranslate"><span class="pre">exit</span></code> from the command prompt.</p>
<p>For far more information on running Docker containers, you can look at <a class="reference external" href="https://docs.docker.com/engine/reference/run/">Docker’s documentation</a>.</p>
</section>
<section id="building-the-documentation">
<span id="id30"></span><h4><span class="section-number">1.10.4.11.2.2. </span>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Link to this heading"></a></h4>
<p>You can use <code class="docutils literal notranslate"><span class="pre">build_docs</span></code> commands like those given elsewhere in these instructions, <strong>but without the</strong> <code class="docutils literal notranslate"><span class="pre">-d</span></code> <strong>argument</strong> (the <code class="docutils literal notranslate"><span class="pre">-d</span></code> argument launches a new Docker image, but in this case, you are already inside a Docker image, so this is unnecessary). Keep in mind that you will need to specify the path to the documentation build directory according to the Docker file system, not your native file system.</p>
</section>
<section id="viewing-the-built-documentation">
<span id="id31"></span><h4><span class="section-number">1.10.4.11.2.3. </span>Viewing the built documentation<a class="headerlink" href="#viewing-the-built-documentation" title="Link to this heading"></a></h4>
<p>You can view the built documentation <a class="reference internal" href="#previewing-the-built-documentation"><span class="std std-ref">as described above</span></a>. However, in order to find the <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file, keep in mind the mapping between directories in Docker’s environment and those in your native environment.</p>
</section>
<section id="committing-to-git-repositories">
<span id="id32"></span><h4><span class="section-number">1.10.4.11.2.4. </span>Committing to git repositories<a class="headerlink" href="#committing-to-git-repositories" title="Link to this heading"></a></h4>
<p>Any local git configuration information is <em>not</em> picked up by the Docker image. Therefore, if you want to make any git commits from the Docker terminal session, you will need to do one of the following:</p>
<ul class="simple">
<li><p>After doing the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command as above, copy <code class="docutils literal notranslate"><span class="pre">/home/user/mounted_home/.gitconfig</span></code> to <code class="docutils literal notranslate"><span class="pre">/home/user/.gitconfig</span></code>.</p></li>
<li><p>Or run the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span></code> command to set your name and email, as described <a class="reference external" href="https://github.com/ESCOMP/CTSM/wiki/Recommended-git-setup#required-settings">here</a></p></li>
</ul>
</section>
</section>
<section id="installing-required-software-on-your-desktop-laptop-instructions-for-mac">
<span id="installing-required-software-on-your-desktoplaptop-instructions-for-mac"></span><h3><span class="section-number">1.10.4.11.3. </span>Installing required software on your desktop/laptop (instructions for Mac)<a class="headerlink" href="#installing-required-software-on-your-desktop-laptop-instructions-for-mac" title="Link to this heading"></a></h3>
<p>If you choose not to use the Docker-based method described above, you can instead install Sphinx and some related packages locally. <strong>We do not recommend this method, because it can be more challenging to set up and maintain than the method described above. In addition, the instructions here are not regularly tested, so may no longer work. Finally, the use of this method can mean that your Sphinx version differs from the one used to generate the official documentation, which can potentially cause problems.</strong> However, if you cannot use the Docker method for some reason, then you can try this alternative.</p>
<section id="prerequisites-assumptions">
<span id="id33"></span><h4><span class="section-number">1.10.4.11.3.1. </span>Prerequisites / assumptions<a class="headerlink" href="#prerequisites-assumptions" title="Link to this heading"></a></h4>
<p>The following documentation assumes that you have the following available on your machine:</p>
<ul class="simple">
<li><p>A recent version of git, ideally configured according to the recommendations in <a class="reference external" href="https://github.com/ESCOMP/CTSM/wiki/Recommended-git-setup#one-time-git-configuration">https://github.com/ESCOMP/CTSM/wiki/Recommended-git-setup#one-time-git-configuration</a>.</p></li>
<li><p>A recent version of python (python3.5 or later)</p></li>
<li><p>If using a Mac, the <a class="reference external" href="https://brew.sh/">Homebrew package manager</a></p></li>
</ul>
</section>
<section id="installing-sphinx-and-the-necessary-sphinx-theme">
<span id="id35"></span><h4><span class="section-number">1.10.4.11.3.2. </span>Installing Sphinx and the necessary Sphinx theme<a class="headerlink" href="#installing-sphinx-and-the-necessary-sphinx-theme" title="Link to this heading"></a></h4>
<p>Sphinx and the necessary Sphinx theme are python packages that can be installed with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>sphinx
pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/esmci/sphinx_rtd_theme.git@version-dropdown-with-fixes
</pre></div>
</div>
<p>For more details on installing Sphinx, see the <a class="reference external" href="http://www.sphinx-doc.org/en/stable/install.html">Sphinx installation docs</a>.</p>
<p><em>You may then need to update your PATH environment variable to include the path to the</em> <code class="docutils literal notranslate"><span class="pre">sphinx-build</span></code> <em>script.</em></p>
</section>
<section id="installing-latexmk">
<span id="id36"></span><h4><span class="section-number">1.10.4.11.3.3. </span>Installing latexmk<a class="headerlink" href="#installing-latexmk" title="Link to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">latexmk</span></code> is needed both for building the PDF and for creating the equations in the html documentation. On a Mac using homebrew, this can be installed with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>cask<span class="w"> </span>install<span class="w"> </span>mactex
</pre></div>
</div>
<p>Note that you will need to open a new terminal window for the latexmk tool to be added to your path (it is in <code class="docutils literal notranslate"><span class="pre">/Library/TeX/texbin/latexmk</span></code>, which should have been added to your path by the above <code class="docutils literal notranslate"><span class="pre">brew</span></code> command).</p>
</section>
<section id="optionally-installing-components-needed-to-build-the-pdf">
<span id="id37"></span><h4><span class="section-number">1.10.4.11.3.4. </span>Optionally installing components needed to build the PDF<a class="headerlink" href="#optionally-installing-components-needed-to-build-the-pdf" title="Link to this heading"></a></h4>
<p>If you want to build the PDF (not just the html web pages), you <em>may</em> also need rst2pdf. This can be installed with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>rst2pdf
</pre></div>
</div>
</section>
</section>
<section id="building-the-documentation-on-cheyenne">
<span id="id38"></span><h3><span class="section-number">1.10.4.11.4. </span>Building the documentation on cheyenne<a class="headerlink" href="#building-the-documentation-on-cheyenne" title="Link to this heading"></a></h3>
<p>Finally, although we haven’t figured out a way to view the built documentation on cheyenne, you can test the build there, and then transfer the files to your local machine for viewing.</p>
<p>To do so, first ensure that you are using the <code class="docutils literal notranslate"><span class="pre">git</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span></code> modules on cheyenne rather than the default system versions, by doing <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">git</span></code> and <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">python</span></code>. (Note that the default git module has <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span></code> bundled with it.)</p>
<p>Then, the first time you build the documentation, do this one-time setup:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>sphinx
pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>sphinxcontrib-programoutput
pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>git+https://github.com/esmci/sphinx_rtd_theme.git@version-dropdown-with-fixes
</pre></div>
</div>
<p>and add the following to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> or similar file if using bash:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/glade/u/home/<span class="nv">$USER</span>/.local/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>or, if you’re using tcsh, add to your <code class="docutils literal notranslate"><span class="pre">.tcshrc</span></code>:</p>
<div class="highlight-tcsh notranslate"><div class="highlight"><pre><span></span><span class="nb">setenv </span>PATH /glade/u/home/<span class="nv">$USER</span>/.local/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
</section>
</section>
<section id="appendix-editing-tips">
<span id="id39"></span><h2><span class="section-number">1.10.4.12. </span>Appendix: Editing tips<a class="headerlink" href="#appendix-editing-tips" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Please don’t add manual line breaks when writing text, as this harms searchability. (Note that it’s fine to do this in multi-line <code class="docutils literal notranslate"><span class="pre">:math:</span></code> blocks.) For more information, see <a class="reference external" href="https://github.com/ESCOMP/CTSM/issues/2135#issuecomment-1764999337">text-linebreaks</a>.</p></li>
<li><p>You can write the degree symbol ° with Opt-Shift-8 on Mac or Alt+0176 on Windows. Note that this is different from the <a class="reference external" href="https://en.wikipedia.org/wiki/Ordinal_indicator">masculine ordinal indicator</a> º (typed with Opt-0 on Mac). This is much cleaner and more searchable than using RestructuredText syntax to write a superscript-o!</p></li>
<li><p>Whenever possible, please give equations meaningful labels. E.g., for <a class="reference external" href="https://escomp.github.io/ctsm-docs/versions/release-clm5.0/html/tech_note/Crop_Irrigation/CLM50_Tech_Note_Crop_Irrigation.html#equation-25-2">eq. 2.26.2</a>, <code class="docutils literal notranslate"><span class="pre">:label:</span> <span class="pre">gdds_for_cfts</span></code>) instead of numbers (<code class="docutils literal notranslate"><span class="pre">:label:</span> <span class="pre">25.2</span></code>). Numeric labels become obsolete—as you can see in that example!—whenever new equations and/or sections are added. (Note that the equation numbering in the rendered HTML is automatic.)</p></li>
<li><p>Tables defined with the <code class="docutils literal notranslate"><span class="pre">`:table:</span></code> directive &lt;<a class="reference external" href="https://docutils.sourceforge.io/docs/ref/rst/directives.html#table">https://docutils.sourceforge.io/docs/ref/rst/directives.html#table</a>&gt;`_ can be annoying because they’re very sensitive to the cells inside them being precisely the right widths, as defined by the first <code class="docutils literal notranslate"><span class="pre">====</span></code> strings. If you don’t get the widths right, you’ll see “Text in column margin” errors. Instead, define your tables using the <span class="raw-html-md"><a href="https://docutils.sourceforge.io/docs/ref/rst/directives.html#list-table"><code class="docutils literal"><span class="pre">:list-table:</span></code></a></span> directive.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="caveats-for-working-with-markdown.html" class="btn btn-neutral float-left" title="1.10.3. Caveats for working with Markdown" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../tech_note/index.html" class="btn btn-neutral float-right" title="2. CLM Technical Note" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, UCAR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: master
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="../../../../versions/master/html/index.html">master</a></dd>
      
        <dd><a href="../../../../versions/release-clm5.0/html/index.html">release-clm5.0</a></dd>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>